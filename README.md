# MyFirstProject
Spring boot 와 Java를 처음 독학하며 만들어본 게시판 프로젝트

책을 따라하며 게시판을 만들며 동시에 스스로 나만의 개선된 게시판을 만들어보았다.
## 개요

### 개발 개요
* 소요 기간 : 약 11일
* 1인 개발

### 주요 기술
* 사용 언어 : JAVA
* 사용 프레임워크 : Spring boot 2.7.5
* 사용된 주요기술 : Spring Mvc , Ajax, MyBatis, MySql, Thymeleaf
* 부가 기술 : BootStrap, Logback, Log4JDBC

### 이 게시판의 주요 기능은 다음과 같다.
* 스프링 MVC를 이용한 게시판
* 게시글 추가, 삭제, 수정
* 파일 업로드, 다운로드 기능
* 댓글 작성 및 조회
* 썸네일이 보이는 게시글 리스트
* 게시글 리스트에 (~초 전 , ~ 분 전, ~ 달 전) 이런식으로 시간이 표시되는 기능
* aop, transaction
* interceptor와 session을 이용한 로그인 및 인증

### 프로젝트를 읽으며 같이 공부한 책
1. 스프링 부트 시작하기(차근차근 따라 하는 단계별 실습) - 김인우 저 인사이트(insight)
2. 자바의 정석 - 남궁성 저 도우출판 

## 본문
### 파일과 DB를 같이 트랜잭션 하기
파일 업로드를 포함한 게시글 등록 기능에 트랜잭션을 적용하던 중 문제가 생겼다.  
게시글 등록 service에는 크게 두가지 기능이 있었다.  
* 파일을 서버에 저장하는 기능
* 게시글을 DB에 등록시키는 기능
파일을 저장기능은 파일 자체는 로컬 디렉토리에 저장하고, 파일의 정보와 경로는 DB에 저장해 놓았다.

하지만 문제는 트랜잭션 처리시 DB는 잘 롤백 되었지만, 로컬 디렉토리에 저장되던 파일은 롤백되지 않았다.  
그래서 try-catch문을 이용해 예외를 잡고 직접 저장했던 파일들을 제거해주는 로직을 추가했다.  
로직이 실행되고 나면 에러를 발생시켜 다른 모든 DB작업들을 롤백시켰다.  
[블로그 정리](https://better-clean-fast.tistory.com/55)

### 세션과 쿠키, 인터셉터를 이용한 로그인 체크
내가 공부한 책에서는 로그인과 관련된 부분이 나오지 않았다.  
* 내가 원하는 기능은 로그인이 되지 않은 사용자가 다른 주소로 접속시 자동으로 로그인 페이지로 리다이렉트
* 게시글이나 댓글 작성시 유저 식별
그래서 구글링을 통해 session과 cookie , interceptor를 이용해 로그인 처리를 구현하였다.  
그리고 로그아웃 기능도 세션 삭제를 통해 만들었다.

### 파일 업로드 다운로드 기능
Multipart와 MIME을 공부하여 이 기능을 구현하였고, 구글링을 통해 파일 다운로드 기능의 두가지 방법에 대해 정리했다.  
[블로그 정리](https://velog.io/@on5949/SpringBoot%ED%8C%8C%EC%9D%BC-%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C%EC%9D%98-%EB%91%90%EA%B0%80%EC%A7%80-%EB%B0%A9%EB%B2%95)

### ajax를 활용한 댓글기능
ajax를 처음 접하고 공부했다. 그리고 ajax와 thymeleaf fragment를 이용해 댓글 기능을 만들었다.  

### 썸네일이 보이는 게시글 리스트
책에서 게시글 리스트가 나오는 부분은 단순한 표 리스트 형식으로 주어졌다.  
하지만 나는 사용자가 첨부 사진을 올린 경우라면 그 중 첫번째 이미지를 선별해 게시글 카드에 썸네일이 보이도록 했다.  
만약 첨부 사진이 없으면 기본 이미지가 출력되게 하였다.

### 게시글 리스트에 개선된 시간 표시
책에서 게시글 리스트에서 시간은 단순히 2022/12/12 00:00:00 이런식으로 표시하였다.  
내가 만든 게시판에서는 (~초 전 , ~ 분 전, ~ 달 전) 이런식으로 적절한 시간을 표시한다.  
이 로직은 단순히 계산만 하는 것이 아닌, 어떤 시간 단위로 표시를 할지 선택하는 로직과 시간 경과를 계산하는 로직이 함께 있다.

#### 참고
![image](https://user-images.githubusercontent.com/115917020/206949097-e42ec21c-0a6e-4345-b789-f540d6edaedd.png)

### 로그인 후 뒤로가기 방지
이 기능은 interceptor를 이용한 로그인 기능을 구현하기 전에 만든 기능이라 현재는 쓸모가 없어졌다.  
기존의 책에서 제시한 방법은 로그인 버튼을 누르면 로그인 페이지로 넘어가고, 로그인이 되면 게시글 페이지로 이동하는 방식이었다.

하지만 직접 사용해보니 뒤로가기를 누르면 로그인이 된 상태에서도 다시 로그인 페이지가 나오는 상황이 발생하였다.  
그래서 javascript modal 라이브러리에 iframe을 적용시켜, 히스토리 기록을 막고, 직접적으로 로그인 페이지에 접속하는 경로를 숨겼다.  
하지만 이 방식은 추후 별로 좋지 않다는 것을 느꼈다. iframe에서 새창 열기와 같은 다양한 상황에서 잘 못 잘동하였다.  
그래서 추후에 interceptor를 이용한 세션 처리로 방법을 바꾸었다.  

그리고 추후에 ajax기능을 배웠고, 향후에 비슷한 기능을 추가할때는 ajax와 fragment 기술을 사용하는 것이 나을 것 같다고 판단하게 되었다.

## 프로젝트 캡쳐

### 맨 처음 페이지
![image](https://user-images.githubusercontent.com/115917020/206948751-a6a8651c-2465-4620-a776-224fe64f7676.png)

### 로그인 모달 창
![image](https://user-images.githubusercontent.com/115917020/206948884-fef21327-8f9f-45ba-b982-c16946bdb7a5.png)

### 게시글 목록 창
![image](https://user-images.githubusercontent.com/115917020/206949097-e42ec21c-0a6e-4345-b789-f540d6edaedd.png)

### 게시글 등록
![image](https://user-images.githubusercontent.com/115917020/206949287-5d0dba9e-c6a8-4203-adb3-e8a893c6b978.png)

### 게시글 상세 페이지
#### 제목과 내용
![image](https://user-images.githubusercontent.com/115917020/206949398-e6881e98-5ba0-4a46-9365-8ea1cd4a9ef3.png)
#### 그림표시와 다운로드 버튼
애니메이션으로 화살표를 누르면 옆으로 부드럽게 다음 사진으로 넘어간다.  
다운로드 버튼을 누르면 그림이 다운로드 된다.
![image](https://user-images.githubusercontent.com/115917020/206949677-0c38eb53-4ac3-4aa9-956e-03e0ddd70e95.png)

### 댓글 기능
![image](https://user-images.githubusercontent.com/115917020/206949784-77a7e3f7-a858-4dcd-9e8d-8ad3e0f93243.png)
![image](https://user-images.githubusercontent.com/115917020/206949844-18172dc6-c70d-4631-9776-529fe8d412ef.png)

